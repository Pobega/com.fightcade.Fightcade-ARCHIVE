app-id: com.fightcade.Fightcade
base: org.electronjs.Electron2.BaseApp
base-version: "19.08"
runtime: org.freedesktop.Platform
runtime-version: "20.08"
sdk: org.freedesktop.Sdk
command: fightcade
tags:
  - proprietary

sdk-extensions:
  - org.freedesktop.Sdk.Compat.i386
  - org.freedesktop.Sdk.Extension.toolchain-i386

build-options:
  cflags:
    - "-O2 -g -fstack-protector-strong -D_FORTIFY_SOURCE=2"
  cxxflags:
    - "-O2 -g -fstack-protector-strong -D_FORTIFY_SOURCE=2"
  prefix: /app
  prepend-path: /app/bin
  strip: true
  make-args:
    - --silent

finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --env=LD_LIBRARY_PATH=/app/lib:/app/lib32
  - --allow=multiarch

modules:
  - name: fightcade
    buildsystem: simple
    sources:
      - type: archive
        url: https://web.fightcade.com/download/Fightcade-linux-latest.tar.gz
        sha256: 6d89b806fc270c7e5dc6cf9035fb549ce746f676b8c3876eba55b0c62c9ee9cc
    build-commands:
      # Fightcade launcher
      - install -Dm755 Fightcade.desktop /app/share/applications/com.fightcade.Fightcade.desktop
      - desktop-file-edit --set-key=Comment --set-value="Play arcade games online" /app/share/applications/com.fightcade.Fightcade.desktop
      - desktop-file-edit --set-key=Exec --set-value=/app/bin/fightcade /app/share/applications/com.fightcade.Fightcade.desktop
      - desktop-file-edit --set-key=Icon --set-value=/app/fightcade/fc2-electron/resources/app/icon.png /app/share/applications/com.fightcade.Fightcade.desktop
      # Place entire Fightcade zip contents in /app/fightcade
      - mkdir -p /app/fightcade
      - mv * /app/fightcade

  - name: fightcade-launcher
    buildsystem: simple
    sources:
      - type: file
        path: fightcade-launcher.sh
    build-commands:
      - install -Dm755 fightcade-launcher.sh /app/bin/fightcade

  - name: setup-32bit
    buildsystem: simple
      #    sources:
      #- type: file,
      #  path: ld.so.conf
    build-commands:
      - ln -s /app/lib32/lib/ld-linux.so.2 /app/lib/ld-linux.so.2
        #- install -Dm644 ld.so.conf /app/etc/ld.so.conf

  - name: wine
    buildsystem: simple
    build-commands:
      - chmod +x winebuild.sh && ./winebuild.sh
    no-make-install: true
    sources:
      - type: archive
        url: https://dl.winehq.org/wine/source/5.0/wine-5.0.1.tar.xz
        sha256: 12b13405c4bc0d6e1a3991c0b0542562669c9b7d8307f11ff75aa17378345894
      - type: file
        path: winebuild.sh
